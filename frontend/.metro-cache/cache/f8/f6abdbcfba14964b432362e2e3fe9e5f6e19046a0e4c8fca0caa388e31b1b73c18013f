{"dependencies":[{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":33},"end":{"line":2,"column":69,"index":102}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"../store/userStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":104},"end":{"line":3,"column":50,"index":154}}],"key":"IgQi61grymUjzhOUT2rUJCaLs54=","exportNames":["*"],"imports":1}},{"name":"./api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":156},"end":{"line":4,"column":40,"index":196}}],"key":"FbKPDeRJ9TF3vg1eKYKz12urgic=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.useLevel = useLevel;\n  exports.hydrateLevelIfMissing = hydrateLevelIfMissing;\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[0], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _storeUserStore = require(_dependencyMap[1], \"../store/userStore\");\n  var _api = require(_dependencyMap[2], \"./api\");\n  // frontend/utils/levelState.ts\n\n  const KEY = 'fk:selected_level';\n  function normalizeLevel(v) {\n    const s = String(v ?? '').toLowerCase();\n    if (s === 'primaria' || s === 'secundaria') return s;\n    return 'inicial';\n  }\n\n  /**\r\n   * Hook centralizado para leer/escribir el nivel educativo:\r\n   * - Fuente 1: user.selected_level del store.\r\n   * - Fuente 2 (fallback): AsyncStorage si aún no hay user.\r\n   * - Al cambiar nivel: actualiza store, guarda en AsyncStorage y notifica backend (si hay user.id).\r\n   */\n  function useLevel() {\n    const user = (0, _storeUserStore.useUserStore)(s => s.user);\n    const setUser = (0, _storeUserStore.useUserStore)(s => s.setUser);\n\n    // 1) nivel desde el usuario si existe\n    let raw = user?.selected_level;\n\n    // 2) compat: si alguna vez quedó “educationLevel/difficulty”\n    if (!raw) {\n      const st = _storeUserStore.useUserStore.getState?.();\n      raw = st?.educationLevel ?? st?.difficulty ?? raw;\n    }\n    const level = normalizeLevel(raw);\n    const setLevel = async next => {\n      const normalized = normalizeLevel(next);\n\n      // a) Actualizar store\n      if (user && typeof setUser === 'function') {\n        try {\n          setUser({\n            ...user,\n            selected_level: normalized\n          });\n        } catch {}\n      }\n\n      // b) Persistir localmente\n      try {\n        await AsyncStorage.default.setItem(KEY, normalized);\n      } catch {}\n\n      // c) Notificar backend (opcional si hay user)\n      try {\n        if (user?.id) await (0, _api.updateUserLevel)(user.id, normalized).catch(() => {});\n      } catch {}\n    };\n    return {\n      level,\n      setLevel\n    };\n  }\n\n  /** Hidrata el nivel desde AsyncStorage cuando aún no hay user cargado. */\n  async function hydrateLevelIfMissing() {\n    try {\n      const stored = await AsyncStorage.default.getItem(KEY);\n      if (!stored) return;\n      const lvl = normalizeLevel(stored);\n      const st = _storeUserStore.useUserStore.getState?.();\n      const user = st?.user;\n      if (user && st?.setUser) {\n        st.setUser({\n          ...user,\n          selected_level: lvl\n        });\n      }\n    } catch {}\n  }\n});","lineCount":91,"map":[[12,2,22,0,"exports"],[12,9,22,0],[12,10,22,0,"useLevel"],[12,18,22,0],[12,21,22,0,"useLevel"],[12,29,22,0],[13,2,56,0,"exports"],[13,9,56,0],[13,10,56,0,"hydrateLevelIfMissing"],[13,31,56,0],[13,34,56,0,"hydrateLevelIfMissing"],[13,55,56,0],[14,2,2,0],[14,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[14,42,2,0],[14,45,2,0,"require"],[14,52,2,0],[14,53,2,0,"_dependencyMap"],[14,67,2,0],[15,2,2,0],[15,6,2,0,"AsyncStorage"],[15,18,2,0],[15,21,2,0,"_interopDefault"],[15,36,2,0],[15,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[15,73,2,0],[16,2,3,0],[16,6,3,0,"_storeUserStore"],[16,21,3,0],[16,24,3,0,"require"],[16,31,3,0],[16,32,3,0,"_dependencyMap"],[16,46,3,0],[17,2,4,0],[17,6,4,0,"_api"],[17,10,4,0],[17,13,4,0,"require"],[17,20,4,0],[17,21,4,0,"_dependencyMap"],[17,35,4,0],[18,2,1,0],[20,2,8,0],[20,8,8,6,"KEY"],[20,11,8,9],[20,14,8,12],[20,33,8,31],[21,2,10,0],[21,11,10,9,"normalizeLevel"],[21,25,10,23,"normalizeLevel"],[21,26,10,24,"v"],[21,27,10,30],[21,29,10,42],[22,4,11,2],[22,10,11,8,"s"],[22,11,11,9],[22,14,11,12,"String"],[22,20,11,18],[22,21,11,19,"v"],[22,22,11,20],[22,26,11,24],[22,28,11,26],[22,29,11,27],[22,30,11,28,"toLowerCase"],[22,41,11,39],[22,42,11,40],[22,43,11,41],[23,4,12,2],[23,8,12,6,"s"],[23,9,12,7],[23,14,12,12],[23,24,12,22],[23,28,12,26,"s"],[23,29,12,27],[23,34,12,32],[23,46,12,44],[23,48,12,46],[23,55,12,53,"s"],[23,56,12,54],[24,4,13,2],[24,11,13,9],[24,20,13,18],[25,2,14,0],[27,2,16,0],[28,0,17,0],[29,0,18,0],[30,0,19,0],[31,0,20,0],[32,0,21,0],[33,2,22,7],[33,11,22,16,"useLevel"],[33,19,22,24,"useLevel"],[33,20,22,24],[33,22,22,27],[34,4,23,2],[34,10,23,8,"user"],[34,14,23,12],[34,17,23,15],[34,21,23,15,"useUserStore"],[34,36,23,27],[34,37,23,27,"useUserStore"],[34,49,23,27],[34,51,23,29,"s"],[34,52,23,35],[34,56,23,40,"s"],[34,57,23,41],[34,58,23,42,"user"],[34,62,23,46],[34,63,23,47],[35,4,24,2],[35,10,24,8,"setUser"],[35,17,24,15],[35,20,24,18],[35,24,24,18,"useUserStore"],[35,39,24,30],[35,40,24,30,"useUserStore"],[35,52,24,30],[35,54,24,32,"s"],[35,55,24,38],[35,59,24,43,"s"],[35,60,24,44],[35,61,24,45,"setUser"],[35,68,24,52],[35,69,24,53],[37,4,26,2],[38,4,27,2],[38,8,27,6,"raw"],[38,11,27,9],[38,14,27,12,"user"],[38,18,27,16],[38,20,27,18,"selected_level"],[38,34,27,32],[40,4,29,2],[41,4,30,2],[41,8,30,6],[41,9,30,7,"raw"],[41,12,30,10],[41,14,30,12],[42,6,31,4],[42,12,31,10,"st"],[42,14,31,17],[42,17,31,21,"useUserStore"],[42,32,31,33],[42,33,31,33,"useUserStore"],[42,45,31,33],[42,46,31,42,"getState"],[42,54,31,50],[42,57,31,53],[42,58,31,54],[43,6,32,4,"raw"],[43,9,32,7],[43,12,32,10,"st"],[43,14,32,12],[43,16,32,14,"educationLevel"],[43,30,32,28],[43,34,32,32,"st"],[43,36,32,34],[43,38,32,36,"difficulty"],[43,48,32,46],[43,52,32,50,"raw"],[43,55,32,53],[44,4,33,2],[45,4,35,2],[45,10,35,8,"level"],[45,15,35,23],[45,18,35,26,"normalizeLevel"],[45,32,35,40],[45,33,35,41,"raw"],[45,36,35,44],[45,37,35,45],[46,4,37,2],[46,10,37,8,"setLevel"],[46,18,37,16],[46,21,37,19],[46,27,37,26,"next"],[46,31,37,40],[46,35,37,45],[47,6,38,4],[47,12,38,10,"normalized"],[47,22,38,20],[47,25,38,23,"normalizeLevel"],[47,39,38,37],[47,40,38,38,"next"],[47,44,38,42],[47,45,38,43],[49,6,40,4],[50,6,41,4],[50,10,41,8,"user"],[50,14,41,12],[50,18,41,16],[50,25,41,23,"setUser"],[50,32,41,30],[50,37,41,35],[50,47,41,45],[50,49,41,47],[51,8,42,6],[51,12,42,10],[52,10,42,12,"setUser"],[52,17,42,19],[52,18,42,20],[53,12,42,22],[53,15,42,25,"user"],[53,19,42,29],[54,12,42,31,"selected_level"],[54,26,42,45],[54,28,42,47,"normalized"],[55,10,42,58],[55,11,42,66],[55,12,42,67],[56,8,42,69],[56,9,42,70],[56,10,42,71],[56,16,42,77],[56,17,42,78],[57,6,43,4],[59,6,45,4],[60,6,46,4],[60,10,46,8],[61,8,46,10],[61,14,46,16,"AsyncStorage"],[61,26,46,28],[61,27,46,28,"default"],[61,34,46,28],[61,35,46,29,"setItem"],[61,42,46,36],[61,43,46,37,"KEY"],[61,46,46,40],[61,48,46,42,"normalized"],[61,58,46,52],[61,59,46,53],[62,6,46,55],[62,7,46,56],[62,8,46,57],[62,14,46,63],[62,15,46,64],[64,6,48,4],[65,6,49,4],[65,10,49,8],[66,8,49,10],[66,12,49,14,"user"],[66,16,49,18],[66,18,49,20,"id"],[66,20,49,22],[66,22,49,24],[66,28,49,30],[66,32,49,30,"updateUserLevel"],[66,36,49,45],[66,37,49,45,"updateUserLevel"],[66,52,49,45],[66,54,49,46,"user"],[66,58,49,50],[66,59,49,51,"id"],[66,61,49,53],[66,63,49,55,"normalized"],[66,73,49,65],[66,74,49,66],[66,75,49,67,"catch"],[66,80,49,72],[66,81,49,73],[66,87,49,79],[66,88,49,80],[66,89,49,81],[66,90,49,82],[67,6,49,84],[67,7,49,85],[67,8,49,86],[67,14,49,92],[67,15,49,93],[68,4,50,2],[68,5,50,3],[69,4,52,2],[69,11,52,9],[70,6,52,11,"level"],[70,11,52,16],[71,6,52,18,"setLevel"],[72,4,52,27],[72,5,52,28],[73,2,53,0],[75,2,55,0],[76,2,56,7],[76,17,56,22,"hydrateLevelIfMissing"],[76,38,56,43,"hydrateLevelIfMissing"],[76,39,56,43],[76,41,56,46],[77,4,57,2],[77,8,57,6],[78,6,58,4],[78,12,58,10,"stored"],[78,18,58,16],[78,21,58,19],[78,27,58,25,"AsyncStorage"],[78,39,58,37],[78,40,58,37,"default"],[78,47,58,37],[78,48,58,38,"getItem"],[78,55,58,45],[78,56,58,46,"KEY"],[78,59,58,49],[78,60,58,50],[79,6,59,4],[79,10,59,8],[79,11,59,9,"stored"],[79,17,59,15],[79,19,59,17],[80,6,60,4],[80,12,60,10,"lvl"],[80,15,60,13],[80,18,60,16,"normalizeLevel"],[80,32,60,30],[80,33,60,31,"stored"],[80,39,60,37],[80,40,60,38],[81,6,61,4],[81,12,61,10,"st"],[81,14,61,17],[81,17,61,21,"useUserStore"],[81,32,61,33],[81,33,61,33,"useUserStore"],[81,45,61,33],[81,46,61,42,"getState"],[81,54,61,50],[81,57,61,53],[81,58,61,54],[82,6,62,4],[82,12,62,10,"user"],[82,16,62,14],[82,19,62,17,"st"],[82,21,62,19],[82,23,62,21,"user"],[82,27,62,25],[83,6,63,4],[83,10,63,8,"user"],[83,14,63,12],[83,18,63,16,"st"],[83,20,63,18],[83,22,63,20,"setUser"],[83,29,63,27],[83,31,63,29],[84,8,64,6,"st"],[84,10,64,8],[84,11,64,9,"setUser"],[84,18,64,16],[84,19,64,17],[85,10,64,19],[85,13,64,22,"user"],[85,17,64,26],[86,10,64,28,"selected_level"],[86,24,64,42],[86,26,64,44,"lvl"],[87,8,64,48],[87,9,64,49],[87,10,64,50],[88,6,65,4],[89,4,66,2],[89,5,66,3],[89,6,66,4],[89,12,66,10],[89,13,66,11],[90,2,67,0],[91,0,67,1],[91,3]],"functionMap":{"names":["<global>","normalizeLevel","useLevel","useUserStore$argument_0","setLevel","updateUserLevel._catch$argument_0","hydrateLevelIfMissing"],"mappings":"AAA;ACS;CDI;OEQ;4BCC,kBD;+BCC,qBD;mBEa;yECY,QD;GFC;CFG;OMG;CNW"},"hasCjsExports":false},"type":"js/module"}]}